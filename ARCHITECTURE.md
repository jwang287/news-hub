# Cloudflare å…¨æ ˆæ¶æ„æ–¹æ¡ˆ

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·è®¿é—®å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   æ™®é€šç”¨æˆ·   â”‚    â”‚   ç®¡ç†å‘˜     â”‚    â”‚   å†…å®¹åˆ›ä½œè€…        â”‚ â”‚
â”‚  â”‚  (Pages)    â”‚    â”‚(Zero Trust) â”‚    â”‚  (Zero Trust)       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                  â”‚                       â”‚            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                            â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Cloudflare CDN / Edge Network                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æœåŠ¡å±‚                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Cloudflare Pages (Frontend)                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚  â”‚  React/Vue   â”‚ â”‚ Static HTML  â”‚ â”‚   Admin      â”‚      â”‚ â”‚
â”‚  â”‚  â”‚  (Public)    â”‚ â”‚   (Public)   â”‚ â”‚   Panel      â”‚      â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Cloudflare Functions (Backend)                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚  â”‚  /api/posts  â”‚ â”‚  /api/media  â”‚ â”‚  /api/admin  â”‚      â”‚ â”‚
â”‚  â”‚  â”‚  (CRUD)      â”‚ â”‚  (Upload)    â”‚ â”‚  (Auth)      â”‚      â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®å±‚                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Cloudflare D1 (SQLite Database)               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚  â”‚    posts     â”‚ â”‚    users     â”‚ â”‚   media_refs â”‚      â”‚ â”‚
â”‚  â”‚  â”‚  (content)   â”‚ â”‚  (metadata)  â”‚ â”‚  (R2 links)  â”‚      â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Cloudflare R2 (Object Storage)                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚  â”‚   images/    â”‚ â”‚   videos/    â”‚ â”‚   assets/    â”‚      â”‚ â”‚
â”‚  â”‚  â”‚  (WebP/JPG)  â”‚ â”‚  (MP4/WebM)  â”‚ â”‚  (CSS/JS)    â”‚      â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

## æ ¸å¿ƒæœåŠ¡é€‰å‹

| æœåŠ¡ | ç”¨é€” | å…è´¹é¢åº¦ | ä¼˜åŠ¿ |
|------|------|----------|------|
| **Pages** | å‰ç«¯æ‰˜ç®¡ | æ— é™è¯·æ±‚/æœˆ | å…¨çƒ CDNã€è‡ªåŠ¨éƒ¨ç½² |
| **R2** | å¯¹è±¡å­˜å‚¨ | 10GB/æœˆ | æ— å‡ºå£è´¹ç”¨ã€S3 å…¼å®¹ |
| **D1** | SQLite æ•°æ®åº“ | 500ä¸‡è¡Œè¯»å–/å¤© | è¾¹ç¼˜ SQLã€é›¶å»¶è¿Ÿ |
| **Zero Trust** | èº«ä»½éªŒè¯ | 50ç”¨æˆ· | SSOã€MFAã€Access |
| **Functions** | åç«¯ API | 10ä¸‡æ¬¡è¯·æ±‚/å¤© | è¾¹ç¼˜è®¡ç®—ã€ä½å»¶è¿Ÿ |

## æ•°æ®æµè®¾è®¡

### 1. å†…å®¹å‘å¸ƒæµç¨‹
```
åˆ›ä½œè€…ç™»å½• (Zero Trust)
    â†“
ä¸Šä¼ åª’ä½“ â†’ R2 (ç›´æ¥ä¸Šä¼ æˆ–é¢„ç­¾å URL)
    â†“
å¡«å†™å…ƒæ•°æ® â†’ Functions API
    â†“
å†™å…¥ D1 æ•°æ®åº“ (å†…å®¹ + R2 å¼•ç”¨)
    â†“
CDN ç¼“å­˜åˆ·æ–°
    â†“
ç”¨æˆ·å¯è§
```

### 2. ç”¨æˆ·è®¿é—®æµç¨‹
```
ç”¨æˆ·è¯·æ±‚
    â†“
Cloudflare CDN (ç¼“å­˜æ£€æŸ¥)
    â†“
Pages (é™æ€ HTML)
    â†“
Hydration (åŠ¨æ€å†…å®¹)
    â†“
Functions API (æŸ¥è¯¢ D1)
    â†“
è¿”å› JSON + R2 å›¾ç‰‡ URL
    â†“
æµè§ˆå™¨æ¸²æŸ“
```

### 3. åª’ä½“å¤„ç†æµç¨‹
```
ä¸Šä¼ åŸå§‹æ–‡ä»¶
    â†“
Cloudflare Images (è‡ªåŠ¨ä¼˜åŒ–)
    â†“
ç”Ÿæˆå¤šå°ºå¯¸ç‰ˆæœ¬
    â†“
å­˜å‚¨åˆ° R2
    â†“
è¿”å›ä¼˜åŒ–åçš„ URL
    â†“
D1 è®°å½•å…ƒæ•°æ® (å°ºå¯¸ã€æ ¼å¼ã€URL)
```

## æ•°æ®åº“ Schema (D1)

```sql
-- å†…å®¹è¡¨
CREATE TABLE posts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    slug TEXT UNIQUE NOT NULL,
    content TEXT,
    summary TEXT,
    category TEXT,
    status TEXT DEFAULT 'draft', -- draft, published, archived
    author_id INTEGER,
    featured_image TEXT, -- R2 URL
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    published_at DATETIME,
    view_count INTEGER DEFAULT 0,
    FOREIGN KEY (author_id) REFERENCES users(id)
);

-- åª’ä½“æ–‡ä»¶è¡¨
CREATE TABLE media (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    filename TEXT NOT NULL,
    original_name TEXT,
    r2_key TEXT NOT NULL, -- R2 å­˜å‚¨è·¯å¾„
    r2_url TEXT NOT NULL, -- å®Œæ•´è®¿é—® URL
    content_type TEXT,
    size_bytes INTEGER,
    width INTEGER,
    height INTEGER,
    alt_text TEXT,
    created_by INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (created_by) REFERENCES users(id)
);

-- ç”¨æˆ·è¡¨ (ä¸ Zero Trust é›†æˆ)
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    email TEXT UNIQUE NOT NULL,
    name TEXT,
    role TEXT DEFAULT 'viewer', -- viewer, editor, admin
    avatar_url TEXT,
    zero_trust_id TEXT, -- Zero Trust ç”¨æˆ· ID
    last_login DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- åˆ†ç±»è¡¨
CREATE TABLE categories (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    slug TEXT UNIQUE NOT NULL,
    description TEXT,
    color TEXT, -- åˆ†ç±»é¢œè‰²æ ‡è¯†
    sort_order INTEGER DEFAULT 0
);

-- å†…å®¹ä¸åª’ä½“å…³è”è¡¨
CREATE TABLE post_media (
    post_id INTEGER,
    media_id INTEGER,
    sort_order INTEGER DEFAULT 0,
    PRIMARY KEY (post_id, media_id),
    FOREIGN KEY (post_id) REFERENCES posts(id),
    FOREIGN KEY (media_id) REFERENCES media(id)
);

-- åˆ›å»ºç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
CREATE INDEX idx_posts_status ON posts(status);
CREATE INDEX idx_posts_category ON posts(category);
CREATE INDEX idx_posts_published ON posts(published_at);
CREATE INDEX idx_media_created ON media(created_at);
```

## API è®¾è®¡ (Cloudflare Functions)

### å…¬å…± API (æ— éœ€è®¤è¯)
```
GET  /api/posts              # è·å–æ–‡ç« åˆ—è¡¨
GET  /api/posts/:slug        # è·å–å•ç¯‡æ–‡ç« 
GET  /api/categories         # è·å–åˆ†ç±»åˆ—è¡¨
GET  /api/media/:id          # è·å–åª’ä½“ä¿¡æ¯
```

### ç®¡ç† API (Zero Trust è®¤è¯)
```
GET    /api/admin/posts      # ç®¡ç†åå°æ–‡ç« åˆ—è¡¨
POST   /api/admin/posts      # åˆ›å»ºæ–‡ç« 
PUT    /api/admin/posts/:id  # æ›´æ–°æ–‡ç« 
DELETE /api/admin/posts/:id  # åˆ é™¤æ–‡ç« 

POST   /api/admin/media      # ä¸Šä¼ åª’ä½“
DELETE /api/admin/media/:id  # åˆ é™¤åª’ä½“

GET    /api/admin/stats      # ç»Ÿè®¡æ•°æ®
```

### åª’ä½“ä¸Šä¼ æµç¨‹
```
POST /api/admin/media/presign  # è·å–é¢„ç­¾åä¸Šä¼  URL
   â†“ è¿”å›: { uploadUrl, key, publicUrl }
   
å®¢æˆ·ç«¯ç›´æ¥ä¸Šä¼ æ–‡ä»¶åˆ° R2
   â†“
   
POST /api/admin/media/confirm  # ç¡®è®¤ä¸Šä¼ å®Œæˆ
   â†“ å†™å…¥ D1 æ•°æ®åº“
```

## æ–‡ä»¶ç»“æ„

```
project/
â”œâ”€â”€ frontend/                 # Cloudflare Pages
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ _headers          # HTTP å¤´é…ç½®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/       # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/            # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ api/              # API å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ wrangler.toml
â”‚
â”œâ”€â”€ functions/                # Cloudflare Functions
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ posts.ts          # æ–‡ç«  API
â”‚   â”‚   â”œâ”€â”€ media.ts          # åª’ä½“ API
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚       â”œâ”€â”€ posts.ts      # ç®¡ç† API
â”‚   â”‚       â””â”€â”€ auth.ts       # è®¤è¯æ£€æŸ¥
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ db.ts             # D1 è¿æ¥
â”‚   â”‚   â”œâ”€â”€ r2.ts             # R2 æ“ä½œ
â”‚   â”‚   â””â”€â”€ auth.ts           # Zero Trust éªŒè¯
â”‚   â””â”€â”€ wrangler.toml
â”‚
â”œâ”€â”€ admin-panel/              # ç®¡ç†åå° (Pages)
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ wrangler.toml
â”‚
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ schema.sql            # æ•°æ®åº“ç»“æ„
â”‚   â””â”€â”€ migrations/           # è¿ç§»è„šæœ¬
â”‚
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ deploy-frontend.yml
â”‚       â”œâ”€â”€ deploy-functions.yml
â”‚       â””â”€â”€ deploy-admin.yml
â”‚
â””â”€â”€ wrangler.toml             # æ ¹é…ç½®
```

## Zero Trust é…ç½®

### 1. åˆ›å»º Access åº”ç”¨
```
Name: Admin Panel
Domain: admin.your-domain.com

Session Duration: 24 hours

Identity Providers:
- Google (æ¨è)
- GitHub
- One-time PIN

Policies:
- Allow: ç‰¹å®šé‚®ç®± (@yourcompany.com)
- Allow: ç‰¹å®šç”¨æˆ· (admin@example.com)
- Block: å…¶ä»–æ‰€æœ‰
```

### 2. Functions ä¸­éªŒè¯
```typescript
// functions/utils/auth.ts
export async function verifyAuth(request: Request): Promise<User | null> {
  // æ£€æŸ¥ CF-Access-Jwt-Assertion header
  const jwt = request.headers.get('CF-Access-Jwt-Assertion');
  
  if (!jwt) return null;
  
  // éªŒè¯ JWT (ä½¿ç”¨ Zero Trust å…¬é’¥)
  const isValid = await verifyJWT(jwt, ZERO_TRUST_CERTS);
  
  if (!isValid) return null;
  
  // è§£æç”¨æˆ·ä¿¡æ¯
  const payload = decodeJWT(jwt);
  
  return {
    email: payload.email,
    name: payload.name,
    id: payload.sub
  };
}
```

## GitHub Actions CI/CD

```yaml
# .github/workflows/deploy.yml
name: Deploy to Cloudflare

on:
  push:
    branches: [main]

jobs:
  deploy-frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          
      - name: Install dependencies
        run: npm ci
        
      - name: Build
        run: npm run build
        env:
          VITE_API_URL: ${{ secrets.API_URL }}
          
      - name: Deploy to Pages
        uses: cloudflare/pages-action@v1
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          projectName: my-project
          directory: dist

  deploy-functions:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Deploy Functions
        uses: cloudflare/wrangler-action@v3
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          workingDirectory: functions
          command: deploy
```

## æˆæœ¬ä¼°ç®—

| é¡¹ç›® | å…è´¹é¢åº¦ | é¢„ä¼°ç”¨é‡ | è´¹ç”¨ |
|------|----------|----------|------|
| Pages | æ— é™ | 10ä¸‡è¯·æ±‚/æœˆ | $0 |
| Functions | 10ä¸‡æ¬¡/å¤© | 5ä¸‡æ¬¡/å¤© | $0 |
| R2 | 10GB | 5GB | $0 |
| D1 | 500ä¸‡è¯»å–/å¤© | 100ä¸‡/å¤© | $0 |
| Zero Trust | 50ç”¨æˆ· | 10ç”¨æˆ· | $0 |
| **æ€»è®¡** | - | - | **$0/æœˆ** |

å°æµé‡ç½‘ç«™å®Œå…¨å…è´¹ï¼

## éƒ¨ç½²å‘½ä»¤

```bash
# 1. åˆå§‹åŒ–
npm create cloudflare@latest

# 2. é…ç½® D1
cd functions
wrangler d1 create my-database
# å¤åˆ¶ database_id åˆ° wrangler.toml

# 3. é…ç½® R2
wrangler r2 bucket create my-media

# 4. æ•°æ®åº“è¿ç§»
wrangler d1 execute my-database --file=../database/schema.sql

# 5. éƒ¨ç½²
wrangler deploy  # Functions
wrangler pages deploy  # Pages
```

è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜åŠ¿ï¼š
- ğŸŒ å…¨çƒè¾¹ç¼˜éƒ¨ç½²ï¼Œå»¶è¿Ÿæä½
- ğŸ’° å…è´¹é¢åº¦å……è¶³ï¼Œå°é¡¹ç›®é›¶æˆæœ¬
- ğŸ”’ å†…ç½® DDoS é˜²æŠ¤å’Œ WAF
- ğŸš€ è‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œæ— éœ€è¿ç»´
- ğŸ“¦ ä¸€ä½“åŒ–ç®¡ç†ï¼Œé…ç½®ç®€å•

éœ€è¦æˆ‘å¸®ä½ å®ç°è¿™ä¸ªæ¶æ„çš„å…·ä½“ä»£ç å—ï¼Ÿ
